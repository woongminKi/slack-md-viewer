<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Markdown Viewer</title>
  <link rel="stylesheet" href="/css/github-markdown.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #24292f;
      --border-color: #d0d7de;
      --header-bg: #f6f8fa;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #0d1117;
        --text-color: #c9d1d9;
        --border-color: #30363d;
        --header-bg: #161b22;
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      line-height: 1.5;
    }

    .header {
      background-color: var(--header-bg);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }

    .header .meta {
      font-size: 14px;
      color: #57606a;
    }

    @media (prefers-color-scheme: dark) {
      .header .meta {
        color: #8b949e;
      }
    }

    .container {
      max-width: 980px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .markdown-body {
      background-color: var(--bg-color);
    }

    @media (prefers-color-scheme: dark) {
      .markdown-body {
        color-scheme: dark;
        --color-prettylights-syntax-comment: #8b949e;
        --color-prettylights-syntax-constant: #79c0ff;
        --color-prettylights-syntax-entity: #d2a8ff;
        --color-prettylights-syntax-storage-modifier-import: #c9d1d9;
        --color-prettylights-syntax-entity-tag: #7ee787;
        --color-prettylights-syntax-keyword: #ff7b72;
        --color-prettylights-syntax-string: #a5d6ff;
        --color-prettylights-syntax-variable: #ffa657;
        --color-prettylights-syntax-brackethighlighter-unmatched: #f85149;
        --color-prettylights-syntax-invalid-illegal-text: #f0f6fc;
        --color-prettylights-syntax-invalid-illegal-bg: #8e1519;
        --color-prettylights-syntax-carriage-return-text: #f0f6fc;
        --color-prettylights-syntax-carriage-return-bg: #b62324;
        --color-prettylights-syntax-string-regexp: #7ee787;
        --color-prettylights-syntax-markup-list: #f2cc60;
        --color-prettylights-syntax-markup-heading: #1f6feb;
        --color-prettylights-syntax-markup-italic: #c9d1d9;
        --color-prettylights-syntax-markup-bold: #c9d1d9;
        --color-prettylights-syntax-markup-deleted-text: #ffdcd7;
        --color-prettylights-syntax-markup-deleted-bg: #67060c;
        --color-prettylights-syntax-markup-inserted-text: #aff5b4;
        --color-prettylights-syntax-markup-inserted-bg: #033a16;
        --color-prettylights-syntax-markup-changed-text: #ffdfb6;
        --color-prettylights-syntax-markup-changed-bg: #5a1e02;
        --color-prettylights-syntax-markup-ignored-text: #c9d1d9;
        --color-prettylights-syntax-markup-ignored-bg: #1158c7;
        --color-prettylights-syntax-meta-diff-range: #d2a8ff;
        --color-prettylights-syntax-brackethighlighter-angle: #8b949e;
        --color-prettylights-syntax-sublimelinter-gutter-mark: #484f58;
        --color-prettylights-syntax-constant-other-reference-link: #a5d6ff;
        --color-fg-default: #c9d1d9;
        --color-fg-muted: #8b949e;
        --color-fg-subtle: #6e7681;
        --color-canvas-default: #0d1117;
        --color-canvas-subtle: #161b22;
        --color-border-default: #30363d;
        --color-border-muted: #21262d;
        --color-neutral-muted: rgba(110,118,129,0.4);
        --color-accent-fg: #58a6ff;
        --color-accent-emphasis: #1f6feb;
        --color-attention-subtle: rgba(187,128,9,0.15);
        --color-danger-fg: #f85149;
      }

      /* Dark mode code blocks */
      .hljs {
        background: #161b22 !important;
        color: #c9d1d9 !important;
      }
    }

    /* Light mode code blocks */
    .markdown-body pre {
      background-color: #f6f8fa;
    }

    @media (prefers-color-scheme: dark) {
      .markdown-body pre {
        background-color: #161b22;
      }
    }

    /* 반응형 */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .header {
        padding: 12px 16px;
      }

      .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }

    /* 인쇄 스타일 */
    @media print {
      .header {
        position: static;
      }
    }

    /* Mermaid 다이어그램 스타일 */
    .mermaid {
      text-align: center;
      margin: 16px 0;
    }

    pre code.language-mermaid {
      display: none;
    }

    pre:has(code.language-mermaid) {
      background: transparent !important;
      border: none !important;
      padding: 0 !important;
    }
  </style>
  <!-- Mermaid.js -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <h1><%= title %></h1>
      <span class="meta"><%= fileName %></span>
    </div>
  </header>
  <main class="container">
    <article class="markdown-body">
      <%- html %>
    </article>
  </main>
  <script>
    // Mermaid 초기화
    document.addEventListener('DOMContentLoaded', function() {
      // 다크모드 감지
      const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      mermaid.initialize({
        startOnLoad: false,
        theme: isDark ? 'dark' : 'default',
        securityLevel: 'loose',
      });

      // mermaid 코드 블록 찾기 및 렌더링
      document.querySelectorAll('pre code.language-mermaid, pre code.hljs.language-mermaid').forEach(function(codeBlock, index) {
        const pre = codeBlock.parentElement;
        const code = codeBlock.textContent;

        // 새 div 생성
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = code;

        // pre 태그를 mermaid div로 교체
        pre.parentNode.replaceChild(div, pre);
      });

      // Mermaid 렌더링 실행
      mermaid.run();
    });
  </script>
</body>
</html>
