# Slack Markdown Viewer 작업 내용 (2026.02.15)

## 개요
슬랙에서 .md 파일이 업로드되면, 봇이 자동으로 렌더링된 마크다운 페이지 링크를 댓글로 제공하는 Slack App 개발

## 완료된 작업

### 1. 프로젝트 초기화 ✅

#### 생성된 파일 구조
```
md-viewer/
├── package.json           # 프로젝트 설정 및 의존성
├── .env.example           # 환경 변수 템플릿
├── .gitignore             # Git 제외 파일
├── README.md              # 프로젝트 문서
├── src/
│   ├── app.js             # 메인 진입점 (Express + Slack 통합)
│   ├── config.js          # 환경 설정 관리
│   ├── slack/
│   │   ├── app.js         # Slack Bolt 앱 생성
│   │   └── handlers.js    # file_shared 이벤트 핸들러
│   ├── markdown/
│   │   └── renderer.js    # marked + highlight.js 렌더러
│   ├── storage/
│   │   └── fileStore.js   # TTL 지원 인메모리 저장소
│   └── views/
│       └── viewer.ejs     # 마크다운 뷰어 템플릿
└── public/
    └── css/
        └── github-markdown.css  # GitHub 스타일 CSS
```

#### 설치된 패키지
- `@slack/bolt` - Slack 앱 프레임워크
- `express` - 웹 서버
- `marked` - 마크다운 파서
- `marked-highlight` - 코드 하이라이팅 통합
- `highlight.js` - 코드 syntax highlighting
- `ejs` - 템플릿 엔진
- `dotenv` - 환경 변수 관리

#### 구현된 기능
- **Slack Socket Mode** 연결 (이벤트 수신)
- **file_shared 이벤트** 감지 및 .md 파일 필터링
- **마크다운 → HTML 변환** (GitHub Flavored Markdown, syntax highlighting)
- **GitHub 스타일 뷰어** (다크모드 자동 지원, 반응형 디자인)
- **인메모리 저장소** (TTL 24시간, 자동 정리)

---

## 다음 작업 (미완료)

### 2. Slack App 설정 (api.slack.com)
- [ ] 새 앱 생성
- [ ] Socket Mode 활성화 및 App-Level Token 생성 (`connections:write` scope)
- [ ] Bot Token Scopes 설정:
  - `files:read` - 파일 읽기
  - `chat:write` - 메시지 보내기
- [ ] Event Subscriptions 활성화:
  - `file_shared` - 파일 공유 이벤트
- [ ] 워크스페이스에 앱 설치

### 3. 환경 변수 설정
```bash
cp .env.example .env
```

`.env` 파일에 필요한 값:
```
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_SIGNING_SECRET=your-signing-secret
SLACK_APP_TOKEN=xapp-your-app-token
PORT=3000
BASE_URL=http://localhost:3000
```

### 4. 테스트
```bash
# 서버 실행
npm run dev

# ngrok으로 터널링 (외부 접근 필요 시)
ngrok http 3000
```

### 5. 검증 방법
1. 로컬에서 서버 실행
2. Slack 워크스페이스에 앱 설치
3. 테스트 채널에 .md 파일 업로드
4. 봇이 뷰어 링크를 댓글로 다는지 확인
5. 링크 클릭해서 렌더링 확인

---

## 아키텍처

```
[사용자가 .md 파일 업로드]
        ↓
[Slack → file_shared 이벤트 발생]
        ↓
[Express 서버가 이벤트 수신 (Socket Mode)]
        ↓
[.md 파일 다운로드 & 파싱]
        ↓
[HTML로 렌더링 & 인메모리 저장]
        ↓
[슬랙 채널에 뷰어 링크 댓글]
```

## API Endpoints

| Endpoint | 설명 |
|----------|------|
| `GET /` | 홈 페이지 |
| `GET /view/:id` | 렌더링된 마크다운 뷰어 |
| `GET /health` | 헬스 체크 |

---

## 주요 코드 설명

### file_shared 이벤트 핸들러 (src/slack/handlers.js)
- .md 파일인지 확인
- Slack API로 파일 다운로드
- marked로 HTML 변환
- 고유 ID 생성 후 저장
- 채널에 버튼이 포함된 메시지 전송

### 마크다운 렌더러 (src/markdown/renderer.js)
- GitHub Flavored Markdown 지원
- highlight.js로 코드 블록 syntax highlighting
- 자동 언어 감지

### 인메모리 저장소 (src/storage/fileStore.js)
- Map 객체 기반
- TTL 24시간 (환경변수로 변경 가능)
- 1시간마다 만료 항목 자동 정리
